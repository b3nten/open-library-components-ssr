<title>Open Library - Form Testing</title>
<style>
	.test-section {
		margin-bottom: var(--spacing-section);
		padding-bottom: var(--spacing-section);
		border-bottom: var(--border-width-divider) solid var(--color-border);
	}

	.test-results {
		margin-top: var(--spacing-4);
		padding: var(--spacing-3);
		background-color: var(--color-surface-secondary);
		border-radius: var(--radius-card);
		border-left: 4px solid var(--color-brand-primary);
	}

	.test-results.hidden {
		display: none;
	}

	.test-results h4 {
		margin-top: 0;
		color: var(--color-brand-primary);
	}

	.data-output {
		font-family: monospace;
		background-color: var(--color-surface-primary);
		padding: var(--spacing-2);
		border-radius: var(--radius-input);
		margin-top: var(--spacing-2);
	}

	.data-item {
		display: flex;
		gap: var(--spacing-2);
		padding: var(--spacing-1) 0;
	}

	.data-item strong {
		color: var(--color-brand-primary);
		min-width: 100px;
	}

	.event-log {
		margin-top: var(--spacing-3);
		max-height: 200px;
		overflow-y: auto;
		font-family: monospace;
		font-size: var(--body-font-size-sm);
		background-color: var(--color-surface-primary);
		padding: var(--spacing-2);
		border-radius: var(--radius-input);
	}

	.event-log-item {
		padding: 2px 0;
		border-bottom: 1px solid var(--color-border);
	}

	.event-log-item:last-child {
		border-bottom: none;
	}

	.event-type {
		color: var(--color-brand-primary);
		font-weight: bold;
	}

	.event-timestamp {
		color: var(--color-text-secondary);
		font-size: 0.9em;
	}
</style>
<script type="module">
	document.addEventListener("DOMContentLoaded", () => {
		setupFormTests();
	});

	function setupFormTests() {
		// Test 1: Basic Form Submission
		const basicForm = document.getElementById("basic-form");
		const basicResults = document.getElementById("basic-results");
		const basicOutput = document.getElementById("basic-output");

		basicForm.addEventListener("submit", (e) => {
			e.preventDefault();

			// Get form data using FormData API
			const formData = new FormData(basicForm);
			const data = Object.fromEntries(formData.entries());

			// Display results
			basicResults.classList.remove("hidden");
			basicOutput.innerHTML = Object.entries(data)
				.map(
					([key, value]) => `
            <div class="data-item">
              <strong>${key}:</strong>
              <span>${value || "(empty)"}</span>
            </div>
          `,
				)
				.join("");

			logEvent("basic", "submit", data);
		});

		// Test 2: Multiple Fields with Validation
		const validationForm = document.getElementById("validation-form");
		const validationResults = document.getElementById("validation-results");
		const validationOutput = document.getElementById("validation-output");

		validationForm.addEventListener("submit", (e) => {
			e.preventDefault();

			const formData = new FormData(validationForm);
			const data = Object.fromEntries(formData.entries());

			validationResults.classList.remove("hidden");
			validationOutput.innerHTML = Object.entries(data)
				.map(
					([key, value]) => `
            <div class="data-item">
              <strong>${key}:</strong>
              <span>${value || "(empty)"}</span>
            </div>
          `,
				)
				.join("");

			logEvent("validation", "submit", data);
		});

		// Test 3: Event Logging
		const eventForm = document.getElementById("event-form");
		const eventLog = document.getElementById("event-log");
		const eventInput = eventForm.querySelector("ol-input");

		// Log input events
		eventInput.addEventListener("input", (e) => {
			logEventToUI(eventLog, "input", e.target.value);
		});

		eventInput.addEventListener("change", (e) => {
			logEventToUI(eventLog, "change", e.target.value);
		});

		eventInput.addEventListener("focus", (e) => {
			logEventToUI(eventLog, "focus", "Input focused");
		});

		eventInput.addEventListener("blur", (e) => {
			logEventToUI(eventLog, "blur", "Input blurred");
		});

		eventForm.addEventListener("submit", (e) => {
			e.preventDefault();
			const formData = new FormData(eventForm);
			const data = Object.fromEntries(formData.entries());
			logEventToUI(eventLog, "submit", JSON.stringify(data));
		});

		eventForm.addEventListener("reset", (e) => {
			logEventToUI(eventLog, "reset", "Form was reset");
		});

		// Test 4: Reset functionality
		const resetForm = document.getElementById("reset-form");

		resetForm.addEventListener("reset", (e) => {
			logEvent("reset", "reset", "Form was reset");
			setTimeout(() => {
				console.log(
					"Form values after reset:",
					Object.fromEntries(new FormData(resetForm).entries()),
				);
			}, 0);
		});
	}

	function logEvent(formId, eventType, data) {
		console.log(`[${formId}] ${eventType}:`, data);
	}

	function logEventToUI(logElement, eventType, data) {
		const timestamp = new Date().toLocaleTimeString();
		const logItem = document.createElement("div");
		logItem.className = "event-log-item";
		logItem.innerHTML = `
        <span class="event-timestamp">${timestamp}</span>
        <span class="event-type">${eventType}</span>: ${data}
      `;
		logElement.insertBefore(logItem, logElement.firstChild);

		// Keep only last 20 events
		while (logElement.children.length > 20) {
			logElement.removeChild(logElement.lastChild);
		}
	}
</script>
